# E2Eãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«é‡è¤‡ãƒ»ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³èª¿æŸ»å ±å‘Šæ›¸

## ğŸ“‹ èª¿æŸ»æ¦‚è¦

**èª¿æŸ»å¯¾è±¡**: `tests/e2e/test_e2e_pipeline_*.py` (38ãƒ•ã‚¡ã‚¤ãƒ«)  
**èª¿æŸ»æ—¥**: 2025å¹´6æœˆ12æ—¥  
**ç›®çš„**: åŒä¸€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«å¯¾ã™ã‚‹è¤‡æ•°ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å¿…è¦æ€§ã¨é‡è¤‡ã®ç¢ºèª  

## ğŸ” ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

### **1. å®Œå…¨é‡è¤‡ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå‰Šé™¤æ¨å¥¨ï¼‰**

#### A. action_point_current_month_entry ç³»
- `test_e2e_pipeline_action_point_current_month_entry.py` (31,566 bytes)
- `test_e2e_pipeline_action_point_current_month_entry_fixed.py` (31,566 bytes)
- **çŠ¶æ³**: å®Œå…¨ã«åŒä¸€å†…å®¹
- **æ¨å¥¨**: `_fixed.py`ã‚’å‰Šé™¤

#### B. point_lost_email ç³»
- `test_e2e_pipeline_point_lost_email.py` (22,118 bytes)
- `test_e2e_pipeline_point_lost_email_fixed.py` (22,118 bytes)
- **çŠ¶æ³**: å®Œå…¨ã«åŒä¸€å†…å®¹
- **æ¨å¥¨**: `_fixed.py`ã‚’å‰Šé™¤

### **2. ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³åˆ†æ**

## ğŸ“Š ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«åˆ†æ

### **client_dm ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³** (4ãƒ•ã‚¡ã‚¤ãƒ«)
```
client_dm.py                (19,685 bytes) - æ¨™æº–ç‰ˆï¼ˆåŒæœŸï¼‰
client_dm_backup.py         (19,338 bytes) - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç‰ˆ
client_dm_new.py            (19,694 bytes) - æ–°ç‰ˆ
client_dm_simple.py         (11,679 bytes) - ç°¡ç•¥ç‰ˆ
client_dm_sync.py           (35,688 bytes) - åŒæœŸå¼·åŒ–ç‰ˆ
```
**åˆ†æçµæœ**:
- âœ… **simpleç‰ˆ**: æ˜ç¢ºã«ç•°ãªã‚‹ï¼ˆåŸºæœ¬æ©Ÿèƒ½ã®ã¿ï¼‰
- âš ï¸ **æ¨™æº–ç‰ˆã€backupã€newç‰ˆ**: æ©Ÿèƒ½çš„é‡è¤‡ã®å¯èƒ½æ€§
- âœ… **syncç‰ˆ**: å¤§å¹…ã«ç•°ãªã‚‹ï¼ˆåŒæœŸæ©Ÿèƒ½å¼·åŒ–ï¼‰

### **marketing_client_dm ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³** (4ãƒ•ã‚¡ã‚¤ãƒ«)
```
marketing_client_dm.py                      (17,397 bytes) - æ¨™æº–ç‰ˆ
marketing_client_dm_comprehensive.py        (17,400 bytes) - åŒ…æ‹¬ç‰ˆ  
marketing_client_dm_old.py                  (27,995 bytes) - æ—§ç‰ˆ
marketing_client_dm_comprehensive_corrupted.py (17,883 bytes) - ç ´æç‰ˆ
```
**åˆ†æçµæœ**:
- âœ… **oldç‰ˆ**: æ—§å®Ÿè£…ä¿æŒï¼ˆ460åˆ—å¯¾å¿œå‰ï¼‰
- âš ï¸ **æ¨™æº–ç‰ˆã€comprehensiveç‰ˆ**: ã»ã¼åŒä¸€ã‚µã‚¤ã‚ºï¼ˆé‡è¤‡ç–‘ã„ï¼‰
- âš ï¸ **corruptedç‰ˆ**: é–‹ç™ºä¸­ã®ç ´æãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå‰Šé™¤æ¨å¥¨ï¼‰

### **point_grant_email ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³** (3ãƒ•ã‚¡ã‚¤ãƒ«)
```
point_grant_email.py              (18,770 bytes) - æ¨™æº–ç‰ˆ
point_grant_email_externalized.py (21,954 bytes) - å¤–éƒ¨åŒ–ç‰ˆ
point_grant_email_simple.py       (5,940 bytes) - ç°¡ç•¥ç‰ˆ
```
**åˆ†æçµæœ**:
- âœ… **externalizedç‰ˆ**: å¤–éƒ¨SQLãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œï¼ˆæ˜ç¢ºã«ç•°ãªã‚‹ï¼‰
- âœ… **simpleç‰ˆ**: åŸºæœ¬æ©Ÿèƒ½ã®ã¿ï¼ˆæ˜ç¢ºã«ç•°ãªã‚‹ï¼‰

### **simpleç‰ˆãƒ‘ã‚¿ãƒ¼ãƒ³** (6ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³)
```
lim_settlement_breakdown_repair_simple.py   (5,285 bytes)
line_id_link_info_simple.py                (4,840 bytes)
moving_promotion_list_simple.py            (9,198 bytes)
mtg_mail_permission_simple.py              (9,085 bytes)
payment_alert_simple.py                    (5,201 bytes)
point_grant_email_simple.py                (5,940 bytes)
```
**åˆ†æçµæœ**:
- âœ… **å…¨ã¦å¿…è¦**: é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°ç”¨ã®ç°¡ç•¥ç‰ˆã¨ã—ã¦æœ‰åŠ¹

## ğŸ¯ æ”¹å–„ææ¡ˆ

### **å³åº§ã«å‰Šé™¤æ¨å¥¨** (2ãƒ•ã‚¡ã‚¤ãƒ«)
1. `test_e2e_pipeline_action_point_current_month_entry_fixed.py`
2. `test_e2e_pipeline_point_lost_email_fixed.py`

### **è©³ç´°èª¿æŸ»ãŒå¿…è¦** (4ãƒ•ã‚¡ã‚¤ãƒ«)
1. `test_e2e_pipeline_marketing_client_dm_comprehensive_corrupted.py` - ç ´æãƒ•ã‚¡ã‚¤ãƒ«ç–‘ã„
2. `test_e2e_pipeline_client_dm_backup.py` - æ©Ÿèƒ½é‡è¤‡ç–‘ã„
3. `test_e2e_pipeline_client_dm_new.py` - æ©Ÿèƒ½é‡è¤‡ç–‘ã„
4. `test_e2e_pipeline_marketing_client_dm_comprehensive.py` - æ¨™æº–ç‰ˆã¨ã®é‡è¤‡ç–‘ã„

### **ä¿æŒæ¨å¥¨** (32ãƒ•ã‚¡ã‚¤ãƒ«)
- simpleç‰ˆ: é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°ç”¨ã¨ã—ã¦æœ‰åŠ¹
- syncç‰ˆ: åŒæœŸæ©Ÿèƒ½å¼·åŒ–ã¨ã—ã¦æœ‰åŠ¹
- externalizedç‰ˆ: å¤–éƒ¨SQLå¯¾å¿œã¨ã—ã¦æœ‰åŠ¹
- oldç‰ˆ: ãƒ¬ã‚¬ã‚·ãƒ¼å¯¾å¿œã¨ã—ã¦æœ‰åŠ¹

## ğŸ’¡ å‘½åè¦å‰‡ã®å•é¡Œ

### **ç¾åœ¨ã®å•é¡Œ**
- `_fixed`ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹: ä¿®æ­£ç‰ˆã ãŒåŒä¸€å†…å®¹
- `_new`ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹: æ–°ç‰ˆã ãŒæ¨™æº–ç‰ˆã¨é‡è¤‡ç–‘ã„
- `_backup`ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã ãŒå®Ÿéš›ã¯ç•°ãªã‚‹å®Ÿè£…

### **æ¨å¥¨å‘½åè¦å‰‡**
```
{pipeline_name}.py                    # æ¨™æº–çš„ãªå®Ÿè£…
{pipeline_name}_simple.py             # åŸºæœ¬æ©Ÿèƒ½ã®ã¿
{pipeline_name}_sync.py               # åŒæœŸæ©Ÿèƒ½å¼·åŒ–
{pipeline_name}_externalized.py       # å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œ
{pipeline_name}_legacy.py             # ãƒ¬ã‚¬ã‚·ãƒ¼å¯¾å¿œï¼ˆold â†’ legacyï¼‰
```

## ğŸ”§ å®Ÿè£…æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### **Phase 1: å³åº§ã®æ¸…ç† (30åˆ†)**
```bash
# å®Œå…¨é‡è¤‡ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤
rm tests/e2e/test_e2e_pipeline_action_point_current_month_entry_fixed.py
rm tests/e2e/test_e2e_pipeline_point_lost_email_fixed.py

# Gitå±¥æ­´ã¸ã®è¨˜éŒ²
git add -A
git commit -m "Remove duplicate test files: action_point_current_month_entry_fixed and point_lost_email_fixed"
```

### **Phase 2: è©³ç´°èª¿æŸ» (2æ™‚é–“)**
1. **å†…å®¹æ¯”è¼ƒèª¿æŸ»**
   ```bash
   # client_dmç³»ã®æ©Ÿèƒ½å·®åˆ†ç¢ºèª
   diff tests/e2e/test_e2e_pipeline_client_dm.py tests/e2e/test_e2e_pipeline_client_dm_new.py
   
   # marketing_client_dmç³»ã®æ©Ÿèƒ½å·®åˆ†ç¢ºèª
   diff tests/e2e/test_e2e_pipeline_marketing_client_dm.py tests/e2e/test_e2e_pipeline_marketing_client_dm_comprehensive.py
   ```

2. **æ©Ÿèƒ½é‡è¤‡ã®ç¢ºèªã¨çµ±åˆ**

### **Phase 3: å‘½åè¦å‰‡çµ±ä¸€ (1æ™‚é–“)**
```bash
# ãƒ¬ã‚¬ã‚·ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®å‘½åå¤‰æ›´
mv tests/e2e/test_e2e_pipeline_marketing_client_dm_old.py tests/e2e/test_e2e_pipeline_marketing_client_dm_legacy.py

# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
```

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§å‘ä¸Š**
- **ãƒ•ã‚¡ã‚¤ãƒ«æ•°å‰Šæ¸›**: 38 â†’ 34å€‹ (ç´„10%å‰Šæ¸›)
- **é‡è¤‡ã‚³ãƒ¼ãƒ‰é™¤å»**: ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å·¥æ•°å‰Šæ¸›
- **å‘½åè¦å‰‡çµ±ä¸€**: é–‹ç™ºè€…ã®ç†è§£åº¦å‘ä¸Š

### **CI/CDæ€§èƒ½æ”¹å–„**
- **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“çŸ­ç¸®**: é‡è¤‡ãƒ†ã‚¹ãƒˆé™¤å»
- **ãƒ“ãƒ«ãƒ‰æ™‚é–“çŸ­ç¸®**: ãƒ•ã‚¡ã‚¤ãƒ«æ•°å‰Šæ¸›

### **é–‹ç™ºä½“é¨“å‘ä¸Š**
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã®æ˜ç¢ºåŒ–**: ç”¨é€”åˆ¥ã®æ˜ç¢ºãªåŒºåˆ†
- **æ–°è¦é–‹ç™ºåŠ¹ç‡å‘ä¸Š**: çµ±ä¸€ã•ã‚ŒãŸå‘½åè¦å‰‡

## ğŸš¨ æ³¨æ„äº‹é …

### **å‰Šé™¤å‰ã®ç¢ºèªäº‹é …**
1. **Gitå±¥æ­´ã®ç¢ºèª**: å‰Šé™¤å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®é–‹ç™ºå±¥æ­´
2. **CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«åã®å‚ç…§ç¢ºèª
3. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«åã®è¨˜è¼‰ç¢ºèª

### **æ®µéšçš„å®Ÿæ–½ã®ç†ç”±**
- **ãƒªã‚¹ã‚¯æœ€å°åŒ–**: ä¸€åº¦ã«å¤§é‡å‰Šé™¤ã‚’é¿ã‘ã‚‹
- **å½±éŸ¿ç¯„å›²ç¢ºèª**: å„æ®µéšã§ã®å‹•ä½œç¢ºèª
- **ãƒãƒ¼ãƒ åˆæ„**: å¤‰æ›´å†…å®¹ã®æ®µéšçš„ãƒ¬ãƒ“ãƒ¥ãƒ¼

## âœ… çµè«–

**åŒä¸€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«å¯¾ã™ã‚‹è¤‡æ•°ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨æ„ç¾©**:

1. **âœ… å¿…è¦ãªè¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«**
   - `_simple.py`: é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°ç”¨
   - `_externalized.py`: å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œ
   - `_sync.py`: æ©Ÿèƒ½å¼·åŒ–ç‰ˆ
   - `_legacy.py`: ãƒ¬ã‚¬ã‚·ãƒ¼å¯¾å¿œ

2. **âŒ ä¸è¦ãªé‡è¤‡ãƒ•ã‚¡ã‚¤ãƒ«**
   - `_fixed.py`: å®Œå…¨é‡è¤‡ï¼ˆå‰Šé™¤æ¨å¥¨ï¼‰
   - `_corrupted.py`: ç ´æãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå‰Šé™¤æ¨å¥¨ï¼‰

3. **âš ï¸ èª¿æŸ»ãŒå¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«**
   - `_new.py`, `_backup.py`: æ©Ÿèƒ½é‡è¤‡ã®å¯èƒ½æ€§

**æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: Phase 1ã®å³åº§å‰Šé™¤ã‹ã‚‰æ®µéšçš„ã«å®Ÿæ–½ã—ã€ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã®æœ€é©åŒ–ã‚’å›³ã‚‹ã€‚

---
**ãƒ¬ãƒãƒ¼ãƒˆä½œæˆæ—¥**: 2025å¹´6æœˆ12æ—¥  
**æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼**: Phase 1å®Ÿæ–½å¾Œ (2025å¹´6æœˆ13æ—¥)
